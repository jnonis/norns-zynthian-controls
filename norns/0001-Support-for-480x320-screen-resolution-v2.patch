From 6771f6ac626bbaacf7374a6e9b849b9de71488c9 Mon Sep 17 00:00:00 2001
From: Javier Nonis <javiernonis@gmail.com>
Date: Sun, 26 Apr 2020 02:40:47 -0300
Subject: [PATCH] Support for 480x320 screen resolution.

---
 matron.sh                    | 2 +-
 matron/src/hardware/screen.c | 5 +++--
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/matron.sh b/matron.sh
index ba344ad4..5834d0fc 100755
--- a/matron.sh
+++ b/matron.sh
@@ -1,3 +1,3 @@
 #!/bin/bash
 
-./build/ws-wrapper/ws-wrapper ws://*:5555 ./build/matron/matron
+./build/ws-wrapper/ws-wrapper ws://*:5555 ./build/matron/matron -f/dev/fb1
diff --git a/matron/src/hardware/screen.c b/matron/src/hardware/screen.c
index 9ecdc40c..123746f9 100644
--- a/matron/src/hardware/screen.c
+++ b/matron/src/hardware/screen.c
@@ -162,7 +162,7 @@ void screen_init(void) {
     if(surfacefb == NULL) { return; }
     crfb = cairo_create(surfacefb);
 
-    surface = cairo_image_surface_create(CAIRO_FORMAT_ARGB32,128,64);
+    surface = cairo_image_surface_create(CAIRO_FORMAT_ARGB32,384,192);
     cr = cairo_create(surface);
 
     status = FT_Init_FreeType(&value);
@@ -281,8 +281,9 @@ void screen_init(void) {
     cairo_set_font_size(cr, 8.0);
 
     // config buffer
+    cairo_scale(cr, 3, 3);
     cairo_set_operator(crfb, CAIRO_OPERATOR_SOURCE);
-    cairo_set_source_surface(crfb,surface,0,0);
+    cairo_set_source_surface(crfb,surface,48,64);
 }
 
 void screen_deinit(void) {
-- 
2.11.0

